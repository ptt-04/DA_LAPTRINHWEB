<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Shop bán sách</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/NguyenTienPhat_2280620311.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #E31837;  /* Đỏ tươi */
            --secondary-color: #B71C1C;  /* Đỏ đậm */
            --light-bg: #FFF5F5;  /* Trắng hồng nhạt */
            --text-color: #333;
            --white: #FFFFFF;
        }

        /* Reset và Base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--white);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: var(--text-color);
        }

        /* Navbar styles */
        .navbar {
            background-color: var(--primary-color) !important;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .navbar .container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* Logo styles */
        .navbar-brand-wrapper {
            flex-shrink: 0;
        }

        .navbar-brand {
            font-size: 1.8rem;
            padding: 0 !important;
            margin: 0 !important;
        }

        /* Search box styles */
        .search-wrapper {
            padding: 0 2rem;
        }

        .search-box {
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 50px;
            overflow: hidden;
            background: rgba(255,255,255,0.1);
            position: relative;
        }

        .search-box input {
            background: transparent;
            border: none;
            color: var(--white);
            padding: 0.7rem 1.2rem;
            font-size: 0.95rem;
        }

        .search-box input::placeholder {
            color: rgba(255,255,255,0.8);
        }

        .search-btn {
            background: transparent;
            color: var(--white);
            border: none;
            padding: 0 1.5rem;
        }

        /* Menu styles */
        .menu-wrapper {
            flex-shrink: 0;
            gap: 0.5rem;
        }

        .nav-link {
            color: var(--white) !important;
            font-size: 0.95rem;
            padding: 0.5rem 1rem !important;
            border-radius: 25px;
            white-space: nowrap;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.1);
        }

        /* Language switcher */
        .language-switcher {
            border-left: 1px solid rgba(255,255,255,0.2);
            border-right: 1px solid rgba(255,255,255,0.2);
            padding: 0 1rem;
        }

        .btn-link {
            color: var(--white) !important;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Cart badge */
        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--white);
            color: var(--primary-color);
            border-radius: 50%;
            min-width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            padding: 0 6px;
        }

        /* User menu */
        .user-menu {
            margin-left: 0.5rem;
        }

        .dropdown-menu {
            margin-top: 0.5rem !important;
            border: none;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            border-radius: 12px;
            padding: 0.5rem;
        }

        .dropdown-item {
            padding: 0.7rem 1rem;
            border-radius: 8px;
            font-size: 0.95rem;
        }

        .dropdown-item:hover {
            background-color: var(--light-bg);
        }

        /* Responsive adjustments */
        .navbar-brand {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--white) !important;
            padding: 0.5rem 1rem !important;
            transition: all 0.3s ease;
        }
        .nav-link {
            color: var(--white) !important;
            font-size: 1.1rem;
            font-weight: 500;
            padding: 0.7rem 1.2rem !important;
            transition: all 0.3s ease;
            border-radius: 5px;
        }
        .nav-link:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }
        .navbar-brand:hover {
            color: var(--white) !important;
            transform: scale(1.05);
        }
        .search-box {
            width: 500px;
            border: 2px solid var(--white);
            border-radius: 30px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .search-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .search-box input {
            border: none;
            border-radius: 30px 0 0 30px;
            padding: 0.8rem 1.5rem;
            font-size: 1.1rem;
        }
        .search-box input:focus {
            box-shadow: none;
        }
        .search-btn {
            background-color: var(--white);
            color: var(--primary-color);
            border: none;
            padding: 0.8rem 1.5rem;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        .search-btn:hover {
            background-color: var(--light-bg);
            color: var(--primary-color);
        }
        .cart-icon {
            color: var(--white);
            font-size: 1.2rem;
            position: relative;
        }
        .nav-item {
            position: relative;
        }
        .cart-count {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: var(--white);
            color: var(--primary-color);
            border-radius: 50%;
            padding: 0px 6px;
            font-size: 12px;
            min-width: 18px;
            height: 18px;
            line-height: 18px;
            text-align: center;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .dropdown-menu {
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        .dropdown-item {
            padding: 8px 20px;
            transition: all 0.3s ease;
        }
        .dropdown-item:hover {
            background-color: var(--light-bg);
            color: var(--primary-color);
        }
        .dropdown-item.text-danger:hover {
            background-color: #FEE2E2;
        }
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        .btn-primary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        .card {
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        .card-header {
            background-color: var(--primary-color);
            color: var(--white);
            border-radius: 8px 8px 0 0 !important;
        }
        .footer {
            background-color: #fff;
            color: #E31837;
            padding: 30px 0 15px;
            margin-top: auto;
        }
        .footer .col-md-3 {
            margin-bottom: 10px;
        }
        .footer-title {
            color: #E31837;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.08rem;
            text-transform: uppercase;
            position: relative;
        }
        .footer-title::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -7px;
            width: 38px;
            height: 2px;
            background-color: #E31837;
        }
        .footer-contact li {
            margin-bottom: 8px;
            font-size: 0.98rem;
        }
        .footer-social {
            margin-top: 10px;
        }
        .footer-social a {
            width: 28px;
            height: 28px;
            line-height: 28px;
            font-size: 1rem;
            margin-right: 6px;
        }
        .footer .row.align-items-center img {
            height: 32px;
            margin: 0 7px 7px 7px;
        }
        .footer ul.list-unstyled {
            padding-left: 0;
        }
        .footer ul li {
            font-size: 0.98rem;
            color: #333;
        }
        .footer-bottom {
            text-align: center;
            padding-top: 15px;
            margin-top: 20px;
            border-top: 1px solid #FEE2E2;
            color: #333;
            font-size: 0.97rem;
        }
        /* Thêm hiệu ứng hover cho các nút */
        .btn {
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        /* Định dạng cho bảng */
        .table th {
            background-color: var(--light-bg);
            color: var(--text-color);
            font-weight: 600;
        }
        .table td {
            vertical-align: middle;
        }
        /* Badge và label */
        .badge {
            padding: 6px 12px;
            border-radius: 15px;
        }
        .badge-primary {
            background-color: var(--primary-color);
            color: var(--white);
        }
        .main-navbar {
            background-color: var(--primary-color) !important;
            padding: 0.7rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .header-logo .navbar-brand {
            font-size: 1.7rem;
            font-weight: 700;
            color: var(--white) !important;
            padding: 0;
            margin: 0;
            letter-spacing: 1px;
        }
        .brand-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
        }
        .header-search {
            min-width: 220px;
            max-width: 600px;
            display: flex;
            align-items: center;
        }
        .search-box {
            border: 2px solid rgba(255,255,255,0.18);
            border-radius: 30px;
            background: rgba(255,255,255,0.08);
            overflow: hidden;
            width: 100%;
            transition: box-shadow 0.2s;
        }
        .search-box input {
            background: transparent;
            border: none;
            color: var(--white);
            padding: 0.6rem 1.2rem;
            font-size: 1rem;
        }
        .search-box input::placeholder {
            color: rgba(255,255,255,0.8);
        }
        .search-btn {
            background: transparent;
            color: var(--white);
            border: none;
            padding: 0 1.2rem;
            font-size: 1.1rem;
        }
        .header-menu {
            gap: 0.5rem;
        }
        .nav-link {
            color: var(--white) !important;
            font-size: 1rem;
            font-weight: 500;
            padding: 0.5rem 1rem !important;
            border-radius: 25px;
            white-space: nowrap;
            transition: background 0.2s;
        }
        .nav-link:hover {
            background: rgba(255,255,255,0.13);
        }
        .language-switcher {
            border-left: 1px solid rgba(255,255,255,0.18);
            border-right: 1px solid rgba(255,255,255,0.18);
            height: 32px;
            align-items: center;
        }
        .btn-link {
            color: var(--white) !important;
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
        }
        .badge {
            position: absolute;
            top: -7px;
            right: -13px;
            background: var(--white);
            color: var(--primary-color);
            border-radius: 50%;
            min-width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            padding: 0 6px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
        }
        .user-menu {
            margin-left: 0.5rem;
        }
        .cart-link {
            position: relative;
            padding-right: 2rem !important;
        }
        .cart-link .badge {
            position: absolute;
            top: 0;
            right: 0;
            background: #fff;
            color: var(--primary-color);
            border-radius: 50%;
            min-width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            padding: 0 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        /* Thêm style cho danh sách gợi ý */
        #search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 0 0 4px 4px;
            margin-top: 2px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1050;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #search-suggestions .list-group-item {
            border-left: none;
            border-right: none;
            padding: 8px 15px;
        }
        #search-suggestions .list-group-item:first-child {
            border-top: none;
        }
        #search-suggestions .list-group-item:last-child {
            border-bottom: none;
        }
        #search-suggestions img {
            border-radius: 4px;
            width: 50px;
            height: 50px;
            object-fit: cover;
        }
        #search-suggestions .product-info {
            flex-grow: 1;
            margin-left: 10px;
        }
        #search-suggestions .product-price {
            color: #e60012;
            font-weight: 500;
            margin-top: 4px;
        }
        #search-suggestions .out-of-stock {
            opacity: 0.5;
            filter: grayscale(100%);
        }
        #search-suggestions .badge {
            font-size: 0.75rem;
            padding: 0.25em 0.5em;
        }
        .search-container {
            max-width: 600px;
            min-width: 300px;
        }
        .input-group {
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #searchInput {
            border: 1px solid #e0e0e0;
            border-right: none;
            padding: 0.6rem 1.2rem;
            font-size: 0.95rem;
        }
        #searchInput:focus {
            box-shadow: none;
            border-color: var(--primary-color);
        }
        .btn-search {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.6rem 1.5rem;
            transition: all 0.3s ease;
        }
        .btn-search:hover {
            background-color: var(--secondary-color);
            color: white;
        }
        #search-suggestions {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            max-height: 400px;
            overflow-y: auto;
        }
        #search-suggestions::-webkit-scrollbar {
            width: 6px;
        }
        #search-suggestions::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        #search-suggestions::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        #search-suggestions::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        #search-suggestions .list-group-item {
            border: none;
            border-bottom: 1px solid #f0f0f0;
            padding: 0.8rem 1rem;
        }
        #search-suggestions .list-group-item:last-child {
            border-bottom: none;
        }
        #search-suggestions .list-group-item:hover {
            background-color: #f8f9fa;
        }
        
    </style>
    @await RenderSectionAsync("Styles", required: false)
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg main-navbar">
            <div class="container d-flex align-items-center justify-content-between flex-nowrap">
                <!-- Logo -->
                <div class="header-logo d-flex align-items-center flex-shrink-0" style="min-width:180px;">
                    <a class="navbar-brand d-flex align-items-center" asp-controller="Home" asp-action="Index">
                        <i class="fas fa-book-open me-2"></i>
                        <span class="brand-text">BookRise</span>
                    </a>
                </div>
                <!-- Search -->
                <div class="search-container position-relative flex-grow-1 mx-4">
                    <div class="input-group">
                        <input type="text" id="searchInput" class="form-control" placeholder="Tìm kiếm sản phẩm...">
                        <button class="btn btn-search" type="button" onclick="submitSearch()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    <div id="search-suggestions" class="position-absolute w-100 mt-1 d-none">
                    </div>
                </div>
                <!-- Menu -->
                <div class="header-menu d-flex align-items-center flex-shrink-0 gap-2" style="min-width:420px;">
                    <a class="nav-link d-flex align-items-center" asp-controller="Product" asp-action="Index">
                        <i class="fas fa-book me-1"></i>
                        <span>Sản phẩm</span>
                    </a>
                    <a class="nav-link d-flex align-items-center position-relative cart-link" asp-controller="ShoppingCart" asp-action="Index">
                        <i class="fas fa-shopping-cart me-1"></i>
                        <span>Giỏ hàng</span>
                        @await Component.InvokeAsync("CartCount")
                    </a>
                    <div class="language-switcher d-flex align-items-center px-2 mx-1">
                        <button class="btn btn-link nav-link p-0" onclick="switchLanguage('vi')">VI</button>
                        <span class="text-white mx-1">|</span>
                        <button class="btn btn-link nav-link p-0" onclick="switchLanguage('en')">EN</button>
                    </div>
                    <div class="user-menu ms-2">
                        <partial name="_LoginPartial" />
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div class="container mt-4">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

    @* <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-3 mb-4">
                    <h5 class="footer-title">DỊCH VỤ</h5>
                    <ul class="list-unstyled">
                        <li><a href="#">Điều khoản sử dụng</a></li>
                        <li><a href="#">Chính sách bảo mật thông tin cá nhân</a></li>
                        <li><a href="#">Chính sách bảo mật thanh toán</a></li>
                        <li><a href="#">Giới thiệu Fahasa</a></li>
                        <li><a href="#">Hệ thống trung tâm - nhà sách</a></li>
                    </ul>
                </div>
                <div class="col-md-3 mb-4">
                    <h5 class="footer-title">HỖ TRỢ</h5>
                    <ul class="list-unstyled">
                        <li><a href="#">Chính sách đổi - trả - hoàn tiền</a></li>
                        <li><a href="#">Chính sách bảo hành - bồi hoàn</a></li>
                        <li><a href="#">Chính sách vận chuyển</a></li>
                        <li><a href="#">Chính sách khách sỉ</a></li>
                    </ul>
                </div>
                <div class="col-md-3 mb-4">
                    <h5 class="footer-title">TÀI KHOẢN CỦA TÔI</h5>
                    <ul class="list-unstyled">
                        <li><a href="#">Đăng nhập/Tạo mới tài khoản</a></li>
                        <li><a href="#">Thay đổi địa chỉ khách hàng</a></li>
                        <li><a href="#">Chi tiết tài khoản</a></li>
                        <li><a href="#">Lịch sử mua hàng</a></li>
                    </ul>
                </div>
                <div class="col-md-3 mb-4">
                    <h5 class="footer-title">LIÊN HỆ</h5>
                    <ul class="list-unstyled footer-contact">
                        <li><i class="fas fa-map-marker-alt me-2"></i>60-62 Lê Lợi, Q.1, TP. HCM</li>
                        <li><i class="fas fa-envelope me-2"></i>cskh@fahasa.com.vn</li>
                        <li><i class="fas fa-phone me-2"></i>1900636467</li>
                    </ul>
                    <div class="footer-social">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                        <a href="#"><i class="fab fa-tiktok"></i></a>
                    </div>
                </div>
            </div>
            <div class="row align-items-center mt-4">
                <div class="col-md-12 text-center">
                    <!-- Logo các phương thức thanh toán, vận chuyển -->
                    <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_Play_Store_badge_EN.svg" alt="Google Play" style="height:40px;margin:0 8px;">
                    <img src="https://developer.apple.com/assets/elements/badges/download-on-the-app-store.svg" alt="App Store" style="height:40px;margin:0 8px;">
                    <img src="https://cdn.haitrieu.com/wp-content/uploads/2022/10/Logo-VNPAY-QR.png" alt="VNPAY" style="height:40px;margin:0 8px;">
                    <img src="https://upload.wikimedia.org/wikipedia/vi/0/0c/MoMo_Logo.png" alt="MoMo" style="height:40px;margin:0 8px;">
                    <img src="https://cdn.haitrieu.com/wp-content/uploads/2022/10/Logo-ShopeePay.png" alt="ShopeePay" style="height:40px;margin:0 8px;">
                    <img src="https://cdn.haitrieu.com/wp-content/uploads/2022/10/Logo-ZaloPay.png" alt="ZaloPay" style="height:40px;margin:0 8px;">
                </div>
            </div>
            <div class="footer-bottom">
                <p class="mb-0" style="font-size:0.95rem;">Giấy chứng nhận Đăng ký Kinh doanh số 0304132047 do Sở Kế hoạch và Đầu tư Thành phố Hồ Chí Minh cấp ngày 20/12/2005, đăng ký thay đổi lần thứ 10, ngày 20/05/2022.<br>&copy; @DateTime.Now.Year - BookRise. Tất cả các quyền được bảo lưu.</p>
            </div>
        </div>
    </footer> *@

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script type="text/javascript" src="https://cdn.weglot.com/weglot.min.js"></script>
    <script>
        let currentLang = 'vi';
        function initWeglot(lang) {
            if (lang === 'en') {
                Weglot.initialize({
                    api_key: 'wg_34ef68564597a440ec81b7d2318f4b831',
                    original_language: 'vi',
                    destination_languages: ['en'],
                    cache: true
                });
            }
        }
        function switchLanguage(lang) {
            if (lang === currentLang) return;
            if (window.weglot) {
                window.weglot.destroy();
            }
            initWeglot(lang);
            currentLang = lang;
            setTimeout(() => {
                Weglot.switchTo(lang);
            }, 100);
        }
        // Khởi tạo ban đầu với tiếng Việt
        initWeglot('vi');

        let debounceTimer;
        const searchInput = document.getElementById('searchInput');
        const searchSuggestions = document.getElementById('search-suggestions');

        // Xử lý tìm kiếm khi nhấn nút tìm kiếm
        function submitSearch() {
            const searchTerm = searchInput.value.trim();
            if (searchTerm) {
                window.location.href = `/Product/Index?searchTerm=${encodeURIComponent(searchTerm)}`;
            }
        }

        // Xử lý tìm kiếm khi nhấn Enter
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                submitSearch();
            }
        });

        // Xử lý gợi ý tìm kiếm
        searchInput.addEventListener('input', function() {
                clearTimeout(debounceTimer);
            const q = this.value.trim();

            if (q.length === 0) {
                searchSuggestions.classList.add('d-none');
                searchSuggestions.innerHTML = '';
                    return;
                }

                debounceTimer = setTimeout(function() {
                fetch(`/Product/Suggest?q=${encodeURIComponent(q)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data && data.length > 0) {
                            const html = data.map(p => {
                                const outOfStockClass = !p.isInStock ? 'out-of-stock' : '';
                                const outOfStockBadge = !p.isInStock ? '<span class="badge bg-danger ms-2">Hết hàng</span>' : '';
                                return `
                                    <a href="/Product/Details/${p.id}" class="list-group-item list-group-item-action d-flex align-items-center">
                                        <img src="${p.image || '/images/default-product.png'}" 
                                             class="${outOfStockClass}" 
                                             alt="${p.name}"
                                             style="width:50px;height:50px;object-fit:cover;">
                                        <div class="ms-3 flex-grow-1">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <h6 class="mb-0">${p.name}</h6>
                                                ${outOfStockBadge}
                                            </div>
                                            <div class="product-price">${p.price.toLocaleString('vi-VN')}đ</div>
                                    </div>
                                </a>`;
                            }).join('');
                            
                            searchSuggestions.innerHTML = `<div class="list-group shadow">${html}</div>`;
                            searchSuggestions.classList.remove('d-none');
                        } else {
                            searchSuggestions.innerHTML = `
                                <div class="list-group shadow">
                                    <div class="list-group-item text-center text-muted">
                                        Không tìm thấy sản phẩm
                                    </div>
                                </div>`;
                            searchSuggestions.classList.remove('d-none');
                        }
                    });
                }, 300);
            });
            
        // Ẩn gợi ý khi click ra ngoài
        document.addEventListener('click', function(e) {
            if (!searchInput.contains(e.target) && !searchSuggestions.contains(e.target)) {
                searchSuggestions.classList.add('d-none');
            }
        });
    </script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
